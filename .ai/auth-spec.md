# üîê Dokumentacja Systemu Autentykacji 10xCards

## Spis Tre≈õci

1. [PrzeglƒÖd](#przeglƒÖd)
2. [Architektura Bezpiecze≈Ñstwa](#architektura-bezpiecze≈Ñstwa)
3. [Struktura Interfejsu U≈ºytkownika](#struktura-interfejsu-u≈ºytkownika)
4. [Logika Backendowa](#logika-backendowa)
5. [Implementacja Tras](#implementacja-tras)
6. [Przep≈Çywy Autentykacji](#przep≈Çywy-autentykacji)
7. [Best Practices](#best-practices)
8. [Troubleshooting](#troubleshooting)

---

## PrzeglƒÖd

System autentykacji 10xCards zapewnia bezpieczne zarzƒÖdzanie sesjami u≈ºytkownik√≥w przy u≈ºyciu **Supabase Auth** z tokenami JWT. Implementacja opiera siƒô na **centralizowanej, konfigurowalnej ochronie tras** z wielowarstwowym systemem bezpiecze≈Ñstwa (defense-in-depth).

### Kluczowe Cechy

- ‚úÖ **Centralna konfiguracja tras** - Single source of truth
- ‚úÖ **Defence-in-depth** - 3 warstwy ochrony
- ‚úÖ **JWT w HTTP-only cookies** - Bezpieczne przechowywanie
- ‚úÖ **Automatyczna walidacja** - Na ka≈ºde ≈ºƒÖdanie
- ‚úÖ **Default-deny strategia** - Nowe trasy automatycznie chronione

### Stack Technologiczny

- **Frontend**: Astro 5, React 19, TypeScript 5
- **Styling**: Tailwind CSS 4
- **Backend**: Astro API Routes, Node.js
- **Autentykacja**: Supabase Auth
- **Baza Danych**: PostgreSQL (Supabase)
- **Walidacja**: Zod

---

## Architektura Bezpiecze≈Ñstwa

### Model Wielowarstwowy (Defense-in-Depth)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ≈ªƒÑDANIE HTTP (GET, POST, itp.)                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ WARSTWA 1: MIDDLEWARE (src/middleware/index.ts)            ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ ‚Ä¢ Walidacja JWT z cookies                                   ‚îÇ
‚îÇ ‚Ä¢ Sprawdzenie sesji u≈ºytkownika                             ‚îÇ
‚îÇ ‚Ä¢ Ustawienie Astro.locals.user                              ‚îÇ
‚îÇ ‚Ä¢ Redirect do /auth/login je≈õli brak autentykacji          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                             ‚îÇ
   Trasa Publiczna         Trasa Chroniona
   (bez autentykacji)      (wymaga logowania)
        ‚îÇ                             ‚îÇ
        ‚ñº                             ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ Dostƒôp  ‚îÇ             ‚îÇ U≈ºytkownik     ‚îÇ
   ‚îÇ Zezwolony‚îÇ            ‚îÇ Zalogowany?    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                        ‚îÇ
                  TAK ‚úÖ                  NIE ‚ùå
                    ‚îÇ                        ‚îÇ
                    ‚ñº                        ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ WARSTWA 2: STRONA    ‚îÇ      ‚îÇ Redirect:       ‚îÇ
     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ      ‚îÇ /auth/login?    ‚îÇ
     ‚îÇ ‚Ä¢ Guard clauses      ‚îÇ      ‚îÇ redirect=...    ‚îÇ
     ‚îÇ ‚Ä¢ Walidacja danych   ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ ‚Ä¢ Defensywne czeki   ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ WARSTWA 3: API       ‚îÇ
     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ
     ‚îÇ ‚Ä¢ Weryfikacja user   ‚îÇ
     ‚îÇ ‚Ä¢ Dostƒôp do DB       ‚îÇ
     ‚îÇ ‚Ä¢ Logowanie          ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Warstwy Ochrony

#### **1. Warstwa Middleware (G≈Ç√≥wna Linia Obrony)**

Plik: `src/middleware/index.ts`

- **Uruchamiana na ka≈ºde ≈ºƒÖdanie** - Bez wyjƒÖtk√≥w
- **Walidacja JWT** - Sprawdzenie token√≥w w cookies
- **ZarzƒÖdzanie sesjƒÖ** - Od≈õwie≈ºanie JWTs
- **Routing autentykacji** - Redirect dla niezalogowanych

```typescript
// Przep≈Çyw
1. Ekstrahuj JWT z HTTP-only cookie
2. Waliduj JWT za po≈õrednictwem Supabase
3. Je≈õli wa≈ºny ‚Üí ustaw locals.user
4. Je≈õli nie wa≈ºny lub brak ‚Üí redirect /auth/login
```

#### **2. Warstwa Strony (Obrona Defensywna)**

Pliki: `src/pages/*.astro`

- **Guard clauses** - Sprawdzanie locals.user
- **Walidacja integralno≈õci** - Sprawdzenie id i email
- **Fallback redirect** - Backup dla pewno≈õci

```astro
---
const user = Astro.locals.user;
if (!user) {
  return Astro.redirect("/auth/login");
}
if (!user.id || !user.email) {
  return Astro.redirect("/auth/login");
}
---
```

#### **3. Warstwa API (Kontrola Dostƒôpu do Danych)**

Pliki: `src/pages/api/*.ts`

- **Weryfikacja locals.user** - Przed ka≈ºdƒÖ operacjƒÖ
- **U≈ºycie locals.supabase** - Do operacji DB
- **Nigdy nie ufaj klientowi** - Walidacja server-side

```typescript
export const POST: APIRoute = async ({ locals }) => {
  const user = locals.user;
  if (!user) return new Response("Unauthorized", { status: 401 });

  // Bezpieczne u≈ºycie locals.supabase
  const supabase = locals.supabase;
  // ...
};
```

---

## Struktura Interfejsu U≈ºytkownika

### Strony Publiczne

Dostƒôpne dla wszystkich u≈ºytkownik√≥w bez logowania.

#### **1. Strona Logowania** (`/auth/login`)

```astro
---
// src/pages/auth/login.astro
---

<Layout>
  <LoginForm client:load />
</Layout>
```

**Komponenty React:**

- `LoginForm` - Formularz z polami email i has≈Ço
- Walidacja email i has≈Ça
- Obs≈Çuga b≈Çƒôd√≥w i stanu ≈Çadowania
- Linki do rejestracji i odzyskiwania has≈Ça

**Funkcjonalno≈õƒá:**

```
1. U≈ºytkownik wpisuje email i has≈Ço
2. Formularz waliduje dane (client-side)
3. POST /api/auth/login z po≈õwiadczeniami
4. API zwraca JWT
5. Browser przechowuje JWT w cookie
6. Redirect do /generate
```

#### **2. Strona Rejestracji** (`/auth/register`)

```astro
---
// src/pages/auth/register.astro
---

<Layout>
  <RegisterForm client:load />
</Layout>
```

**Komponenty React:**

- `RegisterForm` - Formularz z email, has≈Ço, potwierdzenie
- Walidacja si≈Çy has≈Ça
- Sprawdzenie dopasowania hase≈Ç
- Komunikaty o b≈Çƒôdach

**Przep≈Çyw:**

```
1. U≈ºytkownik wype≈Çnia formularz
2. Walidacja client-side
3. POST /api/auth/register
4. Supabase tworzy konto
5. Automatyczne zalogowanie
6. Redirect do /generate
```

#### **3. Strona Resetowania Has≈Ça** (`/auth/reset-password`)

```astro
---
// src/pages/auth/reset-password.astro
---

<Layout>
  <ResetPasswordForm client:load />
</Layout>
```

**Komponenty React:**

- `ResetPasswordForm` - Formularz do wys≈Çania emaila resetu
- Email input z ikonƒÖ
- Komunikat sukcesu z informacjƒÖ o wys≈Çaniu emaila
- Informacja, ≈ºe u≈ºytkownik bƒôdzie musia≈Ç ustawiƒá nowe has≈Ço

**Przep≈Çyw:**

```
1. U≈ºytkownik otwiera /auth/reset-password
2. Wpisuje email i kliknie "Reset password"
3. POST /api/auth/reset-password
4. Supabase wysy≈Ça email z linkiem resetowania
5. Poka≈º komunikat: "Sprawd≈∫ email"
6. U≈ºytkownik otwiera link z emaila
```

#### **4. Strona Potwierdzenia Resetowania** (`/auth/reset-password-confirm`) - ‚ú® NOWA

```astro
---
// src/pages/auth/reset-password-confirm.astro
---

<Layout>
  <ResetPasswordConfirmForm client:load />
</Layout>
```

**Komponenty React:**

- `ResetPasswordConfirmForm` - Formularz do ustawienia nowego has≈Ça
- Dwa pola: Nowe has≈Ço + Potwierdzenie has≈Ça
- Wyodrƒôbnia token z URL (`?token=...` lub `?token_hash=...`)
- Walidacja czy has≈Ça siƒô zgadzajƒÖ
- Komunikat sukcesu i automatyczny redirect na /auth/login

**Przep≈Çyw:**

```
1. U≈ºytkownik klika link z emaila
   /auth/reset-password-confirm?token_hash=XXX&type=recovery
2. Strona wyodrƒôbnia token z URL
3. Formularz pozwala wpisaƒá nowe has≈Ço 2x
4. Walidacja: has≈Ça muszƒÖ siƒô zgadzaƒá
5. POST /api/auth/reset-password-confirm { password, token }
6. Supabase weryfikuje token i aktualizuje has≈Ço
7. Sukces ‚Üí Redirect na /auth/login (2 sekundy)
```

### Strony Chronione (Wymaga Logowania)

#### **Strona Generacji** (`/generate`)

```astro
---
// src/pages/generate.astro

// Guard clause - Warstwa defensywna
const user = Astro.locals.user;
if (!user) {
  return Astro.redirect("/auth/login");
}

if (!user.id || !user.email) {
  return Astro.redirect("/auth/login");
}
---

<Layout>
  <FlashcardGenerationView client:load />
</Layout>
```

**Ochrona:**

- Middleware weryfikuje JWT
- Strona sprawdza locals.user
- Komponent React korzysta z API chronionych endpoint√≥w

---

## Logika Backendowa

### Endpointy API Autentykacji

Wszystkie endpointy znajdujƒÖ siƒô w `src/pages/api/auth/`

#### **POST `/api/auth/register`**

**Cel**: Rejestracja nowego u≈ºytkownika

**≈ªƒÖdanie:**

```json
{
  "email": "user@example.com",
  "password": "SecurePass123!"
}
```

**Walidacja:**

- Email: Format poprawny (Zod)
- Has≈Ço: Minimalna d≈Çugo≈õƒá 8 znak√≥w
- Has≈Ço: Zawiera: wielkie litery, ma≈Çe litery, cyfry, znaki specjalne

**Proces:**

```typescript
1. Waliduj dane wej≈õciowe (Zod)
2. Sprawd≈∫, czy email nie istnieje (Supabase)
3. Utw√≥rz konto (supabase.auth.signUp)
4. Ustaw JWT w cookie
5. Zwr√≥ƒá { user: {...}, status: "success" }
```

**Odpowiedzi:**

- `200` - Sukces
- `400` - B≈ÇƒÖd walidacji lub email ju≈º istnieje
- `500` - B≈ÇƒÖd serwera

#### **POST `/api/auth/login`**

**Cel**: Logowanie u≈ºytkownika

**≈ªƒÖdanie:**

```json
{
  "email": "user@example.com",
  "password": "SecurePass123!"
}
```

**Proces:**

```typescript
1. Waliduj dane
2. Wywo≈Çaj supabase.auth.signInWithPassword()
3. Supabase waliduje po≈õwiadczenia
4. Je≈õli OK ‚Üí ustaw JWT w cookie
5. Zwr√≥ƒá { user: {...}, status: "success" }
```

**Odpowiedzi:**

- `200` - Sukces, JWT w cookie
- `400` - B≈Çƒôdne po≈õwiadczenia
- `500` - B≈ÇƒÖd serwera

#### **POST `/api/auth/logout`**

**Cel**: Wylogowanie u≈ºytkownika

**Proces:**

```typescript
1. Sprawd≈∫ locals.user
2. Wywo≈Çaj supabase.auth.signOut()
3. Supabase czy≈õci sesjƒô
4. Browser usuwa JWT cookie
5. Zwr√≥ƒá { status: "success" }
```

#### **POST `/api/auth/reset-password`**

**Cel**: Inicjowanie procesu resetowania has≈Ça

**≈ªƒÖdanie:**

```json
{
  "email": "user@example.com"
}
```

**Proces:**

```typescript
1. Waliduj email
2. Supabase wysy≈Ça email z linkiem resetowania
3. Link zawiera token do weryfikacji
4. Zwr√≥ƒá { status: "success", message: "Email sent" }
```

**Odpowiedzi:**

- `200` - Email wys≈Çany
- `400` - Email invalid lub nie znaleziony
- `500` - B≈ÇƒÖd serwera

#### **POST `/api/auth/reset-password-confirm`** - ‚ú® NOWY

**Cel**: Potwierdzenie resetowania has≈Ça i ustawienie nowego

**≈ªƒÖdanie:**

```json
{
  "password": "NewSecurePass456!",
  "token": "token_hash_from_email"
}
```

**Walidacja:**

- Has≈Ço: Minimalna d≈Çugo≈õƒá 8 znak√≥w
- Token: Wymagane, od Supabase

**Proces:**

```typescript
1. Waliduj has≈Ço i token (Zod)
2. Weryfikuj token u≈ºywajƒÖc supabase.auth.verifyOtp()
   - type: "recovery" (token resetu has≈Ça)
3. Je≈õli token wa≈ºny ‚Üí aktualizuj has≈Ço
   - supabase.auth.updateUser({ password })
4. Je≈õli sukces ‚Üí zwr√≥ƒá { status: "success" }
5. Je≈õli token wygas≈Ç ‚Üí zwr√≥ƒá b≈ÇƒÖd
```

**Odpowiedzi:**

- `200` - Has≈Ço zmienione
- `400` - Token invalid/wygas≈Ç, has≈Ço nie spe≈Çnia wymog√≥w
- `500` - B≈ÇƒÖd serwera

### Walidacja Danych

U≈ºywamy **Zod** do walidacji wej≈õcia:

```typescript
import { z } from "zod";

const LoginSchema = z.object({
  email: z.string().email("Niepoprawny format email"),
  password: z.string().min(8, "Has≈Ço musi mieƒá co najmniej 8 znak√≥w"),
});

const data = LoginSchema.parse(input);
```

### Obs≈Çuga B≈Çƒôd√≥w

**Kodowanie Status√≥w HTTP:**

```
200 OK              - Operacja pomy≈õlna
400 Bad Request     - B≈ÇƒÖd walidacji, email istnieje, dane niepoprawne
401 Unauthorized    - Brak autoryzacji, token wygas≈Ç
403 Forbidden       - Brak uprawnie≈Ñ do zasobu
500 Server Error    - B≈ÇƒÖd po stronie serwera
```

**Logowanie:**

```typescript
try {
  // operacja
} catch (error) {
  console.error("[AUTH_ERROR]", error);
  return new Response(JSON.stringify({ error: "User-friendly message" }), { status: 500 });
}
```

---

## Implementacja Tras

### Konfiguracja Centralna

Plik: `src/middleware/index.ts`

```typescript
const ROUTE_CONFIG = {
  public: [
    "/", // Strona g≈Ç√≥wna
    "/auth/login", // Logowanie
    "/auth/register", // Rejestracja
    "/auth/reset-password", // Reset has≈Ça
    "/auth/reset-password-confirm", // Potwierdzenie resetowania has≈Ça ‚ú® NOWE
    "/api/auth/login", // API endpoint
    "/api/auth/register", // API endpoint
    "/api/auth/reset-password", // API endpoint
    "/api/auth/reset-password-confirm", // API endpoint ‚ú® NOWE
  ],

  protected: [
    "/generate", // Generacja fiszek
    "/api/flashcards", // API fiszek
    "/api/generations", // API generacji
  ],
};
```

### Dodawanie Nowej Trasy Chronionej

**Scenariusz 1: Nowa Strona Astro**

```astro
---
// src/pages/my-new-page.astro

// Guard clause - obowiƒÖzkowe!
const user = Astro.locals.user;
if (!user) {
  return Astro.redirect("/auth/login");
}
---

<Layout title="My Page">
  <h1>Welcome {user.email}</h1>
</Layout>
```

**Middleware automatycznie jƒÖ chroni!** Nie trzeba nic konfigurowaƒá.

**Scenariusz 2: Nowy Endpoint API**

```typescript
// src/pages/api/my-endpoint.ts
import type { APIRoute } from "astro";

export const prerender = false;

export const POST: APIRoute = async ({ request, locals }) => {
  // Walidacja autentykacji
  const user = locals.user;
  if (!user) {
    return new Response(JSON.stringify({ error: "Unauthorized" }), { status: 401 });
  }

  // Logika biznesowa
  const supabase = locals.supabase;
  const { data, error } = await supabase.from("my_table").select("*").eq("user_id", user.id);

  if (error) {
    return new Response(JSON.stringify({ error: error.message }), { status: 500 });
  }

  return new Response(JSON.stringify({ data }), { status: 200 });
};
```

**Middleware automatycznie jƒÖ chroni!**

### Dodawanie Trasy Publicznej

Je≈õli naprawdƒô potrzebujesz nowej publicznej trasy:

```typescript
// src/middleware/index.ts
const ROUTE_CONFIG = {
  public: [
    "/",
    "/auth/login",
    "/auth/register",
    "/auth/reset-password",
    "/api/auth/login",
    "/api/auth/register",
    "/api/auth/reset-password",
    "/about", // ‚Üê NOWA PUBLICZNA STRONA
    "/pricing", // ‚Üê NOWA PUBLICZNA STRONA
  ],
  // ...
};
```

---

## Przep≈Çywy Autentykacji

### Przep≈Çyw Rejestracji

```
U≈ªYTKOWNIK                              APLIKACJA
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Otwiera /auth/register ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ≈Åaduje formularz rejestracji ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Wype≈Çnia email & has≈Ço ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Walidacja (client-side) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ        ‚Ä¢ Email format ‚úì                ‚îÇ
   ‚îÇ        ‚Ä¢ Has≈Ço 8+ znak√≥w ‚úì             ‚îÇ
   ‚îÇ        ‚Ä¢ Has≈Ça siƒô zgadzajƒÖ ‚úì          ‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Klika "Zarejestruj siƒô" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ                        POST /api/auth/register
   ‚îÇ                        {
   ‚îÇ                          email: "user@example.com",
   ‚îÇ                          password: "SecurePass123!"
   ‚îÇ                        }
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                  Supabase
   ‚îÇ                                 create account
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                   JWT token
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Set-Cookie: sb-auth-token ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ { user: {...}, success: true } ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Redirect /generate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                     Middleware
   ‚îÇ                                  validates JWT
   ‚îÇ                                   sets user
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Strona generacji fiszek ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ
```

### Przep≈Çyw Logowania

```
U≈ªYTKOWNIK                              APLIKACJA
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Otwiera /auth/login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ≈Åaduje formularz logowania ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Wpisuje email & has≈Ço ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Walidacja (client-side) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Klika "Zaloguj siƒô" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ                      POST /api/auth/login
   ‚îÇ                      {
   ‚îÇ                        email: "user@example.com",
   ‚îÇ                        password: "SecurePass123!"
   ‚îÇ                      }
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                  Supabase
   ‚îÇ                                 validate
   ‚îÇ                              credentials
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                   JWT token
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Set-Cookie: sb-auth-token ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ { user: {...}, success: true } ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Redirect /generate ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
```

### Przep≈Çyw Wylogowania

```
U≈ªYTKOWNIK                              APLIKACJA
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Klika "Wyloguj siƒô" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ                      POST /api/auth/logout
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                  Supabase
   ‚îÇ                                 sign out
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Clear-Cookie ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ { status: "success" } ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Redirect /auth/login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
```

### Przep≈Çyw Resetowania Has≈Ça

```
U≈ªYTKOWNIK                              APLIKACJA
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Klika "Zapomnia≈Çem has≈Ça" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Formularz email ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Wpisuje email ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Walidacja email ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Klika "Wy≈õlij link" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ               POST /api/auth/reset-password
   ‚îÇ               { email: "..." }
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                  Supabase
   ‚îÇ                              resetPasswordForEmail()
   ‚îÇ                                        ‚îÇ
   ‚îÇ                            üìß Email z linkiem
   ‚îÇ                    Link: /auth/reset-password-confirm
   ‚îÇ                           ?token_hash=XXX&type=recovery
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ "Sprawd≈∫ email" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Komunikat sukcesu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ      "Wys≈Çali≈õmy link resetowania     ‚îÇ
   ‚îÇ       bƒôdziesz musia≈Ç wybraƒá nowe     ‚îÇ
   ‚îÇ       has≈Ço i potwierdziƒá"            ‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Otwiera email ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Klika na link ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ  /auth/reset-password-confirm
   ‚îÇ  ?token_hash=XXX&type=recovery
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ Strona wyodrƒôbnia token z URL ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ<‚îÄ‚îÄ‚îÄ Formularz nowego has≈Ça ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Wpisuje nowe has≈Ço (Has≈Ço) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Potwierdza has≈Ço (Potwierdzenie) ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Walidacja (client-side) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ        ‚Ä¢ Has≈Ça siƒô zgadzajƒÖ ‚úì          ‚îÇ
   ‚îÇ        ‚Ä¢ Has≈Ço 8+ znak√≥w ‚úì             ‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îú‚îÄ Klika "Resetuj has≈Ço" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ         POST /api/auth/reset-password-confirm
   ‚îÇ         {
   ‚îÇ           password: "...",
   ‚îÇ           token: "token_hash_XXX"
   ‚îÇ         }
   ‚îÇ                                        ‚îÇ
   ‚îÇ                                  Supabase
   ‚îÇ                              verifyOtp()
   ‚îÇ                      (type: "recovery")
   ‚îÇ                                        ‚îÇ
   ‚îÇ                              updateUser()
   ‚îÇ                          (password zmienione)
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ { status: "success" } ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Komunikat: "Has≈Ço zmienione" ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ                                        ‚îÇ
   ‚îÇ<‚îÄ‚îÄ‚îÄ‚îÄ Redirect /auth/login (2 sekundy)‚îÄ‚î§
   ‚îÇ
```

**Kluczowe kroki:**

1. **Krok 1 - Wys≈Çanie emaila** (publiczny)

   - U≈ºytkownik wpisuje sw√≥j email
   - POST `/api/auth/reset-password`
   - Supabase wysy≈Ça email z linkiem resetowania
   - Link zawiera token jako parametr URL

2. **Krok 2 - Potwierdzenie has≈Ça** (publiczny, ale z tokenem)
   - U≈ºytkownik klika link z emaila
   - Strona wyodrƒôbnia token z URL
   - U≈ºytkownik wpisuje nowe has≈Ço (2x dla potwierdzenia)
   - POST `/api/auth/reset-password-confirm` z tokenem
   - Has≈Ço aktualizowane w Supabase
   - Redirect na `/auth/login` aby siƒô zalogowaƒá

---

## Best Practices

### ‚úÖ ZAWSZE

1. **Weryfikuj `Astro.locals.user`** przed ka≈ºdym u≈ºyciem

   ```astro
   ---
   const user = Astro.locals.user;
   if (!user) return Astro.redirect("/auth/login");
   ---
   ```

2. **Waliduj dane server-side** - nigdy nie ufaj klientowi

   ```typescript
   const schema = z.object({ email: z.string().email() });
   const data = schema.parse(input); // Rzuci b≈ÇƒÖd je≈õli invalid
   ```

3. **U≈ºywaj `locals.supabase`** do operacji DB

   ```typescript
   const supabase = locals.supabase;
   const { data } = await supabase.from("table").select();
   ```

4. **Loguj zdarzenia bezpiecze≈Ñstwa**

   ```typescript
   console.warn("[SECURITY] Unauthorized access attempt to /generate");
   ```

5. **Obs≈Çuguj b≈Çƒôdy gracefully**
   ```typescript
   try {
     // operacja
   } catch (error) {
     console.error("[ERROR]", error);
     // User-friendly response
   }
   ```

### üîê Best Practices dla Password Reset

**Przep≈Çyw Dwustopniowy - Dlaczego?**

```
‚ùå Z≈ÅE - Jeden link z formularzem
  /auth/reset-password?email=user@example.com&token=XXX
  Ryzyko: token widoczny w history, mo≈ºe byƒá przechwycony

‚úÖ DOBRZE - Dwa kroki z tokenem w URL
  1. Email ‚Üí POST /api/auth/reset-password
  2. Email link ‚Üí /auth/reset-password-confirm?token=XXX
  Bezpiecze≈Ñstwo: token tylko w emailu i URL, przechowywany w stanie komponentu
```

**Token Handling**

```typescript
// ‚úÖ DOBRZE - Extract token once on mount
useEffect(() => {
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token") || params.get("token_hash");
  setToken(token);
}, []);

// ‚ùå Z≈ÅE - Token w React state bez czyszczenia
// Mo≈ºe byƒá logowany w error boundaries
```

**Walidacja Hase≈Ç**

```typescript
// ‚úÖ DOBRZE - Por√≥wnaj na kliencie przed wys≈Çaniem
if (password !== confirmPassword) {
  setError("Passwords do not match");
  return;
}

// Waliduj na backendzie te≈º
const { error } = await supabase.auth.updateUser({ password });
```

**Error Messages**

```typescript
// ‚úÖ DOBRZE - Informuj o wyga≈õniƒôtym tokenie
if (error.includes("invalid")) {
  return "Invalid or expired reset link. Request a new one.";
}

// ‚ùå Z≈ÅE - Zbyt szczeg√≥≈Çowe
if (error) {
  return error.message; // Mo≈ºe leakowaƒá info
}
```

### ‚ùå NIGDY

1. **Nie ufaj client-side authentication checks**

   ```typescript
   // ‚ùå Z≈ÅE
   if (localStorage.getItem("user")) {
     /* ... */
   }

   // ‚úÖ DOBRZE
   if (Astro.locals.user) {
     /* ... */
   }
   ```

2. **Nie eksponuj JWT token√≥w**

   ```typescript
   // ‚ùå Z≈ÅE - nigdy w URL
   redirect(`/page?token=${jwt}`);

   // ‚úÖ DOBRZE - tylko w HTTP-only cookie
   cookies.set("sb-auth-token", jwt, { httpOnly: true });
   ```

3. **Nie pomi≈Ñ middleware checks**

   ```typescript
   // ‚ùå Z≈ÅE - disabled middleware
   export const prerender = true; // w protected page!

   // ‚úÖ DOBRZE
   export const prerender = false; // lub zostavit default
   ```

4. **Nie hardcoduj user IDs**

   ```typescript
   // ‚ùå Z≈ÅE
   const userId = "123456"; // Hardcoded!

   // ‚úÖ DOBRZE
   const userId = locals.user.id;
   ```

5. **Nie cachuj sensitive danych na klientcie**

   ```typescript
   // ‚ùå Z≈ÅE
   localStorage.setItem("userEmail", user.email);

   // ‚úÖ DOBRZE - Server-side only
   locals.user.email;
   ```

6. **Nie exponuj szczeg√≥≈Ç√≥w b≈Çƒôd√≥w**

   ```typescript
   // ‚ùå Z≈ÅE
   return new Response(error.message); // Leak info!

   // ‚úÖ DOBRZE
   return new Response("An error occurred"); // Generic
   ```

---

## Zmienne ≈örodowiskowe

### Wymagane w `.env`

```env
# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
```

### Dokumentacja w `.env.example`

```env
# Supabase Configuration
# Get these from https://supabase.com/dashboard/project/_/settings/api
SUPABASE_URL=your_supabase_project_url
SUPABASE_KEY=your_supabase_anon_key
```

### Jak Znale≈∫ƒá Klucze

1. Zaloguj siƒô na [supabase.com](https://supabase.com)
2. Otw√≥rz projekt ‚Üí Settings ‚Üí API
3. Skopiuj `Project URL` i `anon public` key
4. Wklej do `.env`

**WA≈ªNE**: Nigdy nie commituj `.env` do git!

---

## Troubleshooting

### Problem: U≈ºytkownik Zredirekcjonowany do Logowania po Zalogowaniu

**Objawy:**

- User loguje siƒô pomy≈õlnie
- Strona redirect do /generate
- Ale ca≈Çy czas widzi login page

**Przyczyny:**

1. JWT cookie nie ustawiony prawid≈Çowo
2. Cookie domain/path mismatch
3. Ustawienia cookie browsera

**RozwiƒÖzanie:**

```
1. Wyczy≈õƒá cookies w browser
   Chrome DevTools ‚Üí Application ‚Üí Cookies ‚Üí Delete all
2. Zrestartuj dev server
3. Zaloguj siƒô ponownie
4. Sprawd≈∫ cookies:
   Chrome DevTools ‚Üí Application ‚Üí Cookies
   Powinno byƒá: sb-auth-token
```

### Problem: Chroniona Trasa Dostƒôpna Bez Logowania

**Objawy:**

- U≈ºytkownik mo≈ºe wej≈õƒá na /generate bez logowania
- Middleware nie pracuje

**Przyczyny:**

1. Trasa w `PUBLIC_PATHS`
